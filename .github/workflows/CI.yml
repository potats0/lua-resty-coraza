name: CI

on: [push]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: Clone repository
      uses: actions/checkout@master

    - name: Setup Go
      uses: actions/setup-go@master
      with:
        go-version: 1.20.4

    - name: Build and Install
      run: |
        cd coraza
        ./build.sh configure
        make
        sudo make install
        
    - name: Setup openresty
      uses: leafo/gh-actions-openresty@v1
      with:
        openrestyVersion: "1.21.4.1"

    - name: run test::Nginx
      run: resty -e 'print("hi from lua")'
